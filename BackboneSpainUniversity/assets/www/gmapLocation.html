    <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
    <html> 
    
    <head>
    
    <title>Geolocation</title>
    <meta name="description" content="jQuery Mobile, Google Maps and HTML5" />
    <meta http-equiv="content-language" content="en"/>
    <meta name="viewport" content="width=screen.width, initial-scale=1.0, user-scalable=no" />  
    
    <link rel="stylesheet" href="jquery.mobile/jquery.mobile.min.20110527.css" type="text/css" />
    <link rel="stylesheet" href="gmapdemo.css" type="text/css" />
    <script type="text/javascript" src="jquery.mobile/jquery-1.5.2.min.jsX"></script>
    
    <script src="http://maps.google.com/maps/api/js?sensor=true" type="text/javascript"></script>         
    
    <!-- To use PhoneGap APIs uncomment the following -->         
    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
    
    <script type="text/javascript" src="jquery.mobile/jquery.mobile.min.20110527.js"></script>
    <script type="text/javascript" src="ui/jquery.ui.map.min.js"></script>
    
    <script type="text/javascript">
    $(document).bind('mobileinit',function(){
        $.mobile.selectmenu.prototype.options.nativeMenu = false;
    });
    </script>
    
    </head>
    
    <body> 
    <div data-role="page" id="gmap-ex3">
    
    <header data-role="header" data-theme="c" class="detalles" data-position="fixed">
        <a href="#page-home" data-rel="back" data-icon="back" data-iconpos="notext"></a>
        <h1>Rutas</h1>
    </header>
    
    <script type="text/javascript">
    $('#gmap-ex3').live("pagebeforecreate", function() {
        var useragent = navigator.userAgent;
        var mapdiv = document.getElementById("map_canvas_2");
        var mapitem = document.getElementById("map_item");
        var currentLatLng;
        $('#alert').hide();
    
        
        if ((useragent.indexOf('Android 3.') != -1) && (screen.width >= 800) && (screen.height >= 800)) {
            // galaxy tab
            mapdiv.style.height = '480px';
            mapdiv.style.margin = '0.8em';  				
        } else if ((useragent.indexOf('Android 2.') != -1 ) || (useragent.indexOf('Android 3.') != -1 )) {
            mapitem.style.maxWidth = '490px';
            mapdiv.style.height = '290px';
            mapdiv.style.margin = '0.4em';
        } else {
            mapdiv.style.height = '450px';
            mapdiv.style.margin = '1em';
        }
    }); 
    $('#gmap-ex3').live("pageshow", function() {
        $('.ctrlbtns').fadeIn(3300);
    
        var mapdiv = document.getElementById("map_canvas_2");
    
        var networkstate = navigator.connection.type;
        
        if(networkstate == "none"){
           
            alert('Debe disponer de una conexión para obtener las rutas');
            
            $('#map_canvas_2').hide();
            
            $('#alert').show();
                   
        }else{
        

        
        if ( navigator.geolocation ) {
            navigator.geolocation.getCurrentPosition ( function( position ) {
                currentLatLng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
                accuracy = position.coords.accuracy;
                makeMap(currentLatLng, accuracy);
            }, function(error) {
                currentLatLng = new google.maps.LatLng(42.3375879, -83.049514);
                fadingMsg(null);
                makeMap(currentLatLng);
            } , { timeout: 3400, enableHighAccuracy: true }
            );                                     
        } else { 
            currentLatLng = new google.maps.LatLng(42.3375879, -83.049514);
            fadingMsg(null);
            makeMap(currentLatLng);
        } 
        
        }
    
        $('.ctrlbtns').fadeIn(3300);
    
        function makeMap (curLatLng, accuracy) { 
            $('#map_canvas_2').gmap( { 'center': curLatLng,  'zoom': 11, 'callback': function (map) { 
                $('#map_canvas_2').gmap('displayStreetView', 'map_canvas_2', { 'position' : curLatLng, 'visible' : false, pov: { heading: 15, pitch: 10, zoom: 1 } });
                $('#map_canvas_2').gmap('addMarker', { 'title': 'Your position!', 'bound': true, 
                    'animation': google.maps.Animation.DROP, 'position': curLatLng }, function(map, marker) {
                        $('#map_canvas_2').gmap('addInfoWindow', { 'position': marker.getPosition() },
                                function(iw) {
                            $(marker).click(function() {
                                getGeoSearchData(iw, accuracy, marker);
                                // recenter on marker when iw is closed
                                google.maps.event.addListener(iw, 'closeclick', function() { 
                                    $('#map_canvas_2').gmap('option', 'center', marker.getPosition());
                                });                                                
                            });
                        });  // end addInfoWindow
                    });
    
    
    
    
            }
            });
        } // end makeMap
    
        function getGeoSearchData(iw, accuracy, marker) {
            var accuracyStr = (accuracy === -1) ? 'Near:' : 'Within ' + accuracy + 'm of:';
            $('#map_canvas_2').gmap('search', {'location': marker.getPosition() }, function(found, results) {
                if ( found ) {
                    var addr = results[0].formatted_address.split(', ', 4);

                    iw.setContent('<div id="ex2-iw-content" style="font-weight: bold;font-size:20px;max-width:240px;width:240px;height:9em;max-height:9em;color:blue;">Your Location<br/>Lat: ' 
                            + marker.getPosition().lat().toFixed(4) + ', Lng: ' + marker.getPosition().lng().toFixed(4)
                            + '<br/>' + addr[0] + '<br/>' + addr[1] + ', ' + addr[2] + '<br/>' + addr[3] + '</div>');
                } else {
                    fadingMsg('Datos de geoloalización no disponibles');
                    iw.setContent('<div id="ex2-iw-content" style="font-weight: bold;font-size:20px;max-width:240px;width:240px;height:300px;max-height:300px; !important;color:blue;">Your Location<br/>Lat: ' 
                            + marker.getPosition().lat().toFixed(4) + ', Lng: ' + marker.getPosition().lng().toFixed(4) + '</div>');
                }
                iw.open($('#map_canvas_2').gmap('getMap'), marker);
            });
        }
        

        function fadingMsg (locMsg) {
            var msg = " <span style='color:#f33;font-size:20px;'> Localización no encontrada</span>.";
            var opac = 1.0;
            if (locMsg !== null) {
                msg = locMsg;
                opac = 0.9;
            }
            $("<div class='ui-loader ui-overlay-shadow ui-body-e ui-corner-all'><h1>"
                + msg + "</h1></div>")
                .css({ "display": "block", "opacity": opac, "top": $(window).scrollTop() + 250 })
                .appendTo( $.mobile.pageContainer )
                .delay( 2400 )
                .fadeOut( 1200, function(){
                    $(this).remove();
                });
        }
    
    
        var resetbutton = function(buttonname) { $(buttonname).removeClass("ui-btn-active"); };
        var travelModes = [google.maps.DirectionsTravelMode.DRIVING, google.maps.DirectionsTravelMode.BICYCLING, google.maps.DirectionsTravelMode.WALKING]; 
        $('#ex3-drive').click(function() {
            $('#map_canvas_2').gmap('displayDirections', { 'origin': currentLatLng, 'destination': $('#destino').val(), 'travelMode': travelModes[0],'region':'es' }, { 'panel': document.getElementById('directions')}, function(success, response) {
                if ( success ) {
                    $('#results').show();
                    resetbutton('#ex3-bike');
                    var valor=$('#destino').val();
                    $('#resultados').html("Resultados ruta en coche "+$('#destino option:selected').text());
                } else {
                    noRouteMsg("ruta en coche");
                    $('#results').hide();
                }
            });
            return false;
        });
        $('#ex3-bike').click(function () {
            $('#map_canvas_2').gmap('displayDirections', { 'origin': currentLatLng, 'destination': $('#destino').val(), 'travelMode': travelModes[1],'region':'es' }, { 'panel': document.getElementById('directions')}, function(success, response) {
                if ( success ) {
                    $('#results').show();
                    $('#resultados').html("Resultados ruta en bici "+$('#destino option:selected').text());
                    resetbutton('#ex3-drive');
                } else {
                    noRouteMsg("ruta en bici");
                    $('#results').hide();
                }
            });
            return false;
        });                                                        
        function noRouteMsg (mode) {
            $('<div class="ui-loader ui-overlay-shadow ui-body-e ui-corner-all" style="font-size:22px;"><h1>'
                    + '<span style="color:red;"> No es posible obtener la ' + mode + '</span></h1></div>')
                    .css({ 'display': 'block', 'opacity': 0.9, 'top': $(window).scrollTop() + 100 })
                    .appendTo( $.mobile.pageContainer )
                    .delay( 2400 )
                    .fadeOut( 1100, function(){
                        $(this).remove();
                    });
        }                                           
        var trafficLayer = new google.maps.TrafficLayer();
        $('#ex3-traffic').toggle(function () {                                                  
            trafficLayer.setMap($('#map_canvas_2').gmap('getMap')); 
        }, function() {
            resetbutton(this);
            trafficLayer.setMap(null); 
        } 
        );      
    });
    </script>
    <div data-role="content">
    
    <div class="ui-bar-c ui-corner-all ui-shadow" id="map_item" style="font-size:20px;">				
    <div id="map_canvas_2"></div>
    </div>
    
    <div class="ui-bar-c ui-corner-all ui-shadow" style="margin-top:0.2em;font-size:20px;">
    
    <fieldset class="ui-grid-a">
    <div class="ui-block-a" style="font-size:20px;">
    <label for="from" class="select" style="font-size:20px;">Origen:</label>
    <select name="from" id="from">
    <option value="Your Location">Your Location</option>
    </select>
    </div>
    <div class="ui-block-b" style="font-size:20px;">
    <label for="to" class="select" style="font-size:20px;">Destino:</label>
    <select name="destino" id="destino">
    <option value="38.38675,-0.51133">Universidad de Alicante</option>
    <option value="38.2790,-0.6872">Universidad Miguél Hernández de Elche</option>
    <option value="39.64121,2.64539">Universidad de las Illes Balears</option>
    <option value="38.69486,-0.47596">Universitat Politècnica de València.Campus Alcoy</option>
    <option value="39.48293,-0.34697">Universitat Politècnica de València.Campus Valencia</option>
    <option value="40.33558,-3.87293">Universidad Rey Juan Carlos</option>
    <option value="39.99270,-0.06752">Universidad Jaume I de Castellón</option>
    <option value="36.71720,-4.47413">Universidad de Málaga</option>
    <option value="40.45282,-3.73349">Universidad Complutense de Madrid</option>
    <option value="40.39970,-3.8354">Universidad San Pablo-CEU</option>
    <option value="41.73730,1.82879">Universidad Politécnica de Catalunya.Campus Manresa</option>
    <option value="41.38940,2.11329">Universidad Politécnica de Catalunya.Campus Barcelona</option>
    <option value="41.22102,1.73007">Universidad Politécnica de Catalunya.Campus Vilanova i la Geltrú</option>
    <option value="41.577,2.431">Universidad Politécnica de Catalunya.Campus Mataró</option>
    <option value="40.54700,-3.69170">Universidad Autónoma de Madrid</option>
    <option value="41.68381,-0.88732">Universidad de Zaragoza</option>
    <option value="40.389012,-3.628718">Universidad Politécnica de Madrid</option>
    <option value="43.061865,-2.497061">Mondragón Unibertsitatea</option>
    <option value="40.63255,-4.00051">Universidad a Distancia de Madrid</option>
    <option value="40.45099,-3.98750">Universidad Alfonso X El Sabio</option>
    <option value="40.453352,-3.718885">Universidad Antonio de Nebrija</option>
    <option value="41.50019,2.11166">Universidad Autónoma de Barcelona</option>
    <option value="40.53951,-3.89329">Universidad Camilo José Cela</option>
    <option value="39.542679,-0.385881">Universidad Cardenal Herrera-CEU</option>
    <option value="40.33256,-3.76576">Universidad Carlos III de Madrid</option>
    <option value="37.991301,-1.185898">Universidad Católica San Antonio</option>
    <option value="43.33293,-8.41091">Universidad de A Coruña</option>
    <option value="40.51319,-3.34966">Universidad de Alcalá</option>
    <option value="36.82968,-2.40469">Universidad de Almería</option>
    <option value="41.38681,2.16472">Universidad de Barcelona</option>
    <option value="42.343622,-3.735260">Universidad de Burgos</option>
    <option value="36.533549,-6.303344">Universidad de Cádiz</option>
    <option value="43.471433,-3.801135">Universidad de Cantabria</option>
    <option value="38.990368,-3.920883">Universidad de Castilla-La Mancha.Campus Ciudad Real</option>
    <option value="38.97879,-1.85673">Universidad de Castilla-La Mancha.Campus Albacete</option>
    <option value="37.91435,-4.7193">Universidad de Córdoba</option>
    <option value="38.907797,-6.338669">Universidad de Extremadura.Campus Mérida</option>
    <option value="39.47901,-6.34279">Universidad de Extremadura.Campus Cáceres</option>
    <option value="41.96419,2.82934">Universidad de Girona</option>
    <option value="37.19698,-3.62425">Universidad de Granada</option>
    <option value="37.20177,-6.9192">Universidad de Huelva</option>
    <option value="37.78718,-3.77784">Universidad de Jaén</option>
    <option value="28.48304,-16.32133">Universidad de La Laguna</option>
    <option value="42.465607,-2.426546">Universidad de la Rioja</option>
    <option value="28.073332,-15.451447">Universidad de Las Palmas de Gran Canaria</option>
    <option value="42.61408,-5.56098">Universidad de León</option>
    <option value="41.60811,0.62356">Universidad de Lleida</option>
    <option value="38.02374,-1.17442">Universidad de Murcia</option>
    <option value="43.354993,-5.851437">Universidad de Oviedo.Campus Oviedo</option>
    <option value="43.52439,-5.63441">Universidad de Oviedo.Campus de Gijón</option>
    <option value="41.51182,-5.73517">Universidad de Salamanca.Campus Zamora</option>
    <option value="40.96055,-5.67060">Universidad de Salamanca</option>
    <option value="42.87321,-8.56016">Universidad de Santiago de Compostela</option>
    <option value="37.36240,-5.98654">Universidad de Sevilla</option>
    <option value="41.662717,-4.705378">Universidad de Valladolid</option>
    <option value="41.930684,2.245556">Universidad de Vic</option>
    <option value="42.16999,-8.68852">Universidad de Vigo</option>
    </select>
    </div>
    </fieldset>
    
    <div data-role="controlgroup" data-type="horizontal" style="margin:0.6em 0.3em;font-size:20px;" class="ctrlbtns">
    <a data-role="button" id="ex3-drive">Ruta en coche</a>					
    <a data-role="button" id="ex3-bike">Ruta en bici</a>					
    <a data-role="button" id="ex3-traffic" style="color:#139;">Tráfico</a>			
    </div>
    
    </div>
    
    <div id="results" class="ui-listview ui-listview-inset ui-corner-all ui-shadow" style="display:none;font-size:20px;">
    <div class="ui-li ui-li-divider ui-btn ui-bar-b ui-corner-top ui-btn-up-undefined" style="opacity:1;font-size:20px;" id="resultados">Resultados</div>
    <div id="directions" style="background:#eee;opacity:1;"></div>
    <div class="ui-li ui-li-divider ui-btn ui-bar-b ui-corner-bottom ui-btn-up-undefined"></div>
    </div>
    </div>
    
    <div id="alert" class="ui-listview ui-listview-inset ui-corner-all ui-shadow" style="display:none;font-size:20px;">
    <div class="ui-li ui-li-divider ui-btn ui-bar-b ui-corner-top ui-btn-up-undefined" style="opacity:1;font-size:20px;" id="resultados">No hay conexi&oacute;n</div>
    <div id="directions" style="background:#eee;opacity:1;"></div>
    <p style="text-align:center">
        <img  src="alert.png" />
    </p>
    </div>

    
    <footer data-role="footer" data-theme="c" class="detalles" data-position="fixed">
    <div data-role="navbar">
    <ul>
    <li><a rel="external" href="index.html" style="font-size:20px;">Back to Menu</a></li>
    </ul>
    </div>
    </footer>
    
    </div>
    
    </body>	
    </html>