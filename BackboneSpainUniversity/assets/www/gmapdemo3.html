    <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
    <html> 
    
    <head>
    
    <title>Geolocation</title>
    <meta name="description" content="jQuery Mobile, Google Maps and HTML5" />
    <meta http-equiv="content-language" content="en"/>
    <meta name="viewport" content="width=screen.width, initial-scale=1.0, user-scalable=no" />  
    
    <link rel="stylesheet" href="jquery.mobile/jquery.mobile.min.20110527.css" type="text/css" />
    <link rel="stylesheet" href="gmapdemo.css" type="text/css" />
    <script type="text/javascript" src="jquery.mobile/jquery-1.5.2.min.jsX"></script>
    
    <script src="http://maps.google.com/maps/api/js?sensor=true" type="text/javascript"></script>         
    
    <!-- To use PhoneGap APIs uncomment the following -->         
    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
    
    <script type="text/javascript" src="jquery.mobile/jquery.mobile.min.20110527.js"></script>
    <script type="text/javascript" src="ui/jquery.ui.map.min.js"></script>
    
    <script type="text/javascript">
    $(document).bind('mobileinit',function(){
        $.mobile.selectmenu.prototype.options.nativeMenu = false;
    });
    </script>
    
    </head>
    
    <body> 
    <div data-role="page" class="gmap-bg" id="gmap-ex3"> <!-- START gmap-ex3 -->
    
    <div data-role="header" data-theme="c">
    <a href="#page-home" data-rel="back" data-icon="back" data-iconpos="notext"></a>
    <h1>Route and Travel Mode</h1>
    </div>
    <script type="text/javascript">
    $('#gmap-ex3').live("pagebeforecreate", function() {
        var useragent = navigator.userAgent;
        var mapdiv = document.getElementById("map_canvas_2");
        var mapitem = document.getElementById("map_item");
        var currentLatLng;
    
        if ((useragent.indexOf('Android 3.') != -1) && (screen.width >= 800) && (screen.height >= 800)) {
            // galaxy tab
            mapdiv.style.height = '480px';
            mapdiv.style.margin = '0.8em';  				
        } else if ((useragent.indexOf('Android 2.') != -1 ) || (useragent.indexOf('Android 3.') != -1 )) {
            mapitem.style.maxWidth = '490px';
            mapdiv.style.height = '290px';
            mapdiv.style.margin = '0.4em';
        } else {
            mapdiv.style.height = '450px';
            mapdiv.style.margin = '1em';
        }
    }); 
    $('#gmap-ex3').live("pageshow", function() {
        $('.ctrlbtns').fadeIn(3300);
    
    
    
        if ( navigator.geolocation ) {
            navigator.geolocation.getCurrentPosition ( function( position ) {
                currentLatLng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
                accuracy = position.coords.accuracy;
                makeMap(currentLatLng, accuracy);
            }, function(error) {
                currentLatLng = new google.maps.LatLng(42.3375879, -83.049514);
                fadingMsg(null);
                makeMap(currentLatLng, accuracy);
            } , { timeout: 3400, enableHighAccuracy: true }
            );                                     
        } else { 
            currentLatLng = new google.maps.LatLng(42.3375879, -83.049514);
            fadingMsg(null);
            makeMap(currentLatLng, accuracy);
        } 
    
        $('.ctrlbtns').fadeIn(3300);
    
        function makeMap (curLatLng, accuracy) { 
            $('#map_canvas_2').gmap( { 'center': curLatLng,  'zoom': 11, 'callback': function (map) { 
                $('#map_canvas_2').gmap('displayStreetView', 'map_canvas_2', { 'position' : curLatLng, 'visible' : false, pov: { heading: 15, pitch: 10, zoom: 1 } });
                $('#map_canvas_2').gmap('addMarker', { 'title': 'Your position!', 'bound': true, 
                    'animation': google.maps.Animation.DROP, 'position': curLatLng }, function(map, marker) {
                        $('#map_canvas_2').gmap('addInfoWindow', { 'position': marker.getPosition() },
                                function(iw) {
                            $(marker).click(function() {
                                getGeoSearchData(iw, accuracy, marker);
                                // recenter on marker when iw is closed
                                google.maps.event.addListener(iw, 'closeclick', function() { 
                                    $('#map_canvas_2').gmap('option', 'center', marker.getPosition());
                                });                                                
                            });
                        });  // end addInfoWindow
                    });
    
    
    
    
            }
            });
        } // end makeMap
    
        function getGeoSearchData(iw, accuracy, marker) {
            var accuracyStr = (accuracy === -1) ? 'Near:' : 'Within ' + accuracy + 'm of:';
            $('#map_canvas_2').gmap('search', {'location': marker.getPosition() }, function(found, results) {
                if ( found ) {
                    var addr = results[0].formatted_address.split(', ', 4);
                    // alert('[' + addr[0] + '] [' + addr[1] + '] [' +
                    // addr[2] + '] [' + addr[3] + ']');
                    iw.setContent('<div id="ex2-iw-content" style="font-size:14px;max-width:240px;width:240px;height:9em;max-height:9em;color:green;">You are here!<br/>Lat: ' 
                            + marker.getPosition().lat().toFixed(4) + ', Lng: ' + marker.getPosition().lng().toFixed(4) + '<br/>' + accuracyStr 
                            + '<br/>' + addr[0] + '<br/>' + addr[1] + ', ' + addr[2] + '<br/>' + addr[3] + '</div>');
                } else {
                    fadingMsg('Unable to get GeoSearch data.');
                    iw.setContent('<div id="ex2-iw-content" style="font-size:14px;max-width:240px;width:240px;height:300px;max-height:300px; !important;color:green;">You are here!<br/>Lat: ' 
                            + marker.getPosition().lat().toFixed(4) + ', Lng: ' + marker.getPosition().lng().toFixed(4) + '</div>');
                }
                iw.open($('#map_canvas_2').gmap('getMap'), marker);
            });
        }
    
    
        var resetbutton = function(buttonname) { $(buttonname).removeClass("ui-btn-active"); };
        var travelModes = [google.maps.DirectionsTravelMode.DRIVING, google.maps.DirectionsTravelMode.BICYCLING, google.maps.DirectionsTravelMode.WALKING]; 
        $('#ex3-drive').click(function() {
            $('#map_canvas_2').gmap('displayDirections', { 'origin': currentLatLng, 'destination': $('#to').val(), 'travelMode': travelModes[0],'region':'es' }, { 'panel': document.getElementById('directions')}, function(success, response) {
                if ( success ) {
                    $('#results').show();
                    resetbutton('#ex3-walk');
                    resetbutton('#ex3-bike');
                } else {
                    noRouteMsg("driving");
                    $('#results').hide();
                }
            });
            return false;
        });
        $('#ex3-bike').click(function () {
            $('#map_canvas_2').gmap('displayDirections', { 'origin': currentLatLng, 'destination': $('#to').val(), 'travelMode': travelModes[1],'region':'es' }, { 'panel': document.getElementById('directions')}, function(success, response) {
                if ( success ) {
                    $('#results').show();
                    resetbutton('#ex3-walk');
                    resetbutton('#ex3-drive');
                } else {
                    noRouteMsg("biking");
                    $('#results').hide();
                }
            });
            return false;
        });                     
        $('#ex3-walk').click(function () {
            $('#map_canvas_2').gmap('displayDirections', { 'origin': currentLatLng, 'destination': $('#to').val(), 'travelMode': travelModes[2],'region':'es' }, { 'panel': document.getElementById('directions')}, function(success, response) {
                if ( success ) {
                    $('#results').show();
                    resetbutton('#ex3-bike');
                    resetbutton('#ex3-drive');
                } else {
                    noRouteMsg("walking");
                    $('#results').hide();
                }
            });
            return false;
        });                                     
        function noRouteMsg (mode) {
            $('<div class="ui-loader ui-overlay-shadow ui-body-e ui-corner-all"><h1>'
                    + 'Unable to find given route using <span style="color:red;">' + mode + '</span> travel mode.</h1></div>')
                    .css({ 'display': 'block', 'opacity': 0.9, 'top': $(window).scrollTop() + 100 })
                    .appendTo( $.mobile.pageContainer )
                    .delay( 2400 )
                    .fadeOut( 1100, function(){
                        $(this).remove();
                    });
        }                                           
        var trafficLayer = new google.maps.TrafficLayer();
        $('#ex3-traffic').toggle(function () {                                                  
            trafficLayer.setMap($('#map_canvas_2').gmap('getMap')); 
        }, function() {
            resetbutton(this);
            trafficLayer.setMap(null); 
        } 
        );      
    });
    </script>
    <div data-role="content">
    
    <div class="ui-bar-c ui-corner-all ui-shadow" id="map_item">				
    <div id="map_canvas_2"></div>
    </div>
    
    <div class="ui-bar-c ui-corner-all ui-shadow" style="margin-top:0.2em;">
    
    <fieldset class="ui-grid-a">
    <div class="ui-block-a" style="font-size:12px;">
    <label for="from" class="select">From:</label>
    <select name="from" id="from">
    <option value="Alicante">Alicante</option>
    </select>
    </div>
    <div class="ui-block-b" style="font-size:12px;">
    <label for="to" class="select">To:</label>
    <select name="to" id="to">
    <option value="Elche">Elche</option>
    </select>
    </div>
    </fieldset>
    
    <div data-role="controlgroup" data-type="horizontal" style="margin:0.6em 0.3em;" class="ctrlbtns">
    <a data-role="button" id="ex3-drive">&nbsp;Drive&nbsp;</a>					
    <a data-role="button" id="ex3-bike">&nbsp;Bike&nbsp;</a>			
    <a data-role="button" id="ex3-walk">&nbsp;Walk&nbsp;</a>			
    <a data-role="button" id="ex3-traffic" style="color:#139;">Traffic&nbsp;</a>			
    </div>
    
    </div>
    
    <p><strong>Scroll</strong> down for text directions. <strong>Tap</strong> on direction to see details on map.</p>
    
    <div id="results" class="ui-listview ui-listview-inset ui-corner-all ui-shadow" style="display:none;">
    <div class="ui-li ui-li-divider ui-btn ui-bar-b ui-corner-top ui-btn-up-undefined" style="opacity:1;">Results</div>
    <div id="directions" style="background:#eee;opacity:1;"></div>
    <div class="ui-li ui-li-divider ui-btn ui-bar-b ui-corner-bottom ui-btn-up-undefined"></div>
    </div>
    
    </div>
    
    <div data-role="footer" data-theme="c" >
    <div data-role="navbar">
    <ul>
    <li><a rel="external" href="index.html">Back to Menu</a></li>
    </ul>
    </div>
    </div>
    </div> <!-- /gmap-ex3 -->
    
    </body>	
    </html>